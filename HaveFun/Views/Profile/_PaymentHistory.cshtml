<div class="tab-pane fade" id="gt6" role="tabpanel" aria-labelledby="gt6-tab">
	<title>會員購買記錄</title>
    <div id="app_PayHistory">
        <h1>會員購買記錄</h1>
        <table>
            <thead>
                <tr>
                    <th>日期時間</th>
                    <th>購買品項</th>
                    <th>購買金額</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody>
                <tr v-for="transaction in transactions" :key="transaction.id">
                    <td>{{ formatDate(transaction.date) }}</td>
                    <td>{{ getProductDisplayName(transaction.product) }}</td>
                    <td>{{ formatCurrency(transaction.amount) }}</td>
                    <td>
                        <button @@click="refund(transaction.id)">退款</button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

</div>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 20px;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }

    th, td {
        padding: 10px;
        border: 1px solid #ddd;
        text-align: left;
    }

    th {
        background-color: #f4f4f4;
    }

    button {
        padding: 5px 10px;
        background-color: #ff5722;
        color: white;
        border: none;
        cursor: pointer;
    }

        button:hover {
            background-color: #e64a19;
        }
</style>

<script>    
    var app_PayHistory = Vue.createApp({
        data() {
            return {
                transactions: [] // 存儲交易記錄
            };
        },
        methods: {
            fetchTransactions() {
                // 請求後端 API 獲取購買紀錄
                fetch(`${baseAddress}/api/TransactionsPayApi/user/${userId}`)
                    .then(response => response.json())
                    .then(data => {
                        this.transactions = data;
                    })
                    .catch(error => {
                        console.error('Error fetching data:', error);
                    });
            },
            formatDate(date) {
                const options = { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' };
                return new Date(date).toLocaleString('zh-Hant', options);
            },
            formatCurrency(amount) {
                return new Intl.NumberFormat('zh-Hant', { style: 'currency', currency: 'TWD' }).format(amount);
            },
            getProductDisplayName(productId) {
                // 根據產品 ID 返回對應的顯示名稱
                if (productId === 1) {
                    return "購買白金會員";
                } else if (productId === 2) {
                    return "其他產品名稱"; // 根據實際情況調整
                } else {
                    return "未知產品";
                }
            },
            refund(transactionId) {
                if (confirm("確定要退款嗎？")) {
                    // 請求後端 API 執行退款操作
                    fetch(`/api/TransactionsPayApi/${transactionId}`, {
                        method: 'DELETE'
                    })
                        .then(response => {
                            if (response.ok) {
                                alert('退款成功！');
                                // 更新交易記錄列表
                                this.fetchTransactions();
                            } else {
                                alert('退款失敗！');
                            }
                        })
                        .catch(error => {
                            console.error('Error refunding:', error);
                            alert('退款失敗！');
                        });
                }
            }
        },
        mounted() { 
            // 在 mounted 階段加載購買紀錄
            this.fetchTransactions();
        },
    }).mount("#app_PayHistory");
</script>

