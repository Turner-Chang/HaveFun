<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Friend List</title>
    <style>
        .right {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .member__activity {
            display: none;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <div class="tab-pane fade" id="gt4" role="tabpanel" aria-labelledby="gt4-tab">
        <div class="active-member bg-white mb-4">
            <div id="app">
                <div class="modal-header">
                    <h6>好友列表</h6>
                    <ul class="nav nav-tabs" id="myTab4" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" :class="{ active: activeTab === 'Newest' }" @@click="switchTab('Newest')" id="Newest-tab" type="button" role="tab" aria-controls="Newest" aria-selected="true">好友</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" :class="{ active: activeTab === 'BlackList' }" @@click="switchTab('BlackList')" id="BlackList-tab" type="button" role="tab" aria-controls="BlackList" aria-selected="false">黑名單</button>
                        </li>
                    </ul>
                </div>
                <div class="modal-body group__bottom--body">
                    <div class="tab-content" id="myTabContent4">
                        <div v-if="activeTab === 'Newest'" class="tab-pane fade show active" id="Newest" role="tabpanel" aria-labelledby="Newest-tab">
                            <ul>
                                <li v-for="friend in friends" :key="friend.id">
                                    <div class="top">
                                        <div class="left member--style2">
                                            <div class="member__thumb">
                                                <img :src="friend.profilePicture" alt="member-img">
                                                <span class="member__activity"></span>
                                            </div>
                                        </div>
                                        <div class="right">
                                            <a href="member-single.html"><h6>{{ friend.name }}</h6></a>
                                            <button class="btn btn-danger" @@click="blockUser(friend.id)" v-if="friend.state !== 3">封鎖</button>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                        <div v-if="activeTab === 'BlackList'" class="tab-pane fade show active" id="BlackList" role="tabpanel" aria-labelledby="BlackList-tab">
                            <ul>
                                <li v-for="friend in blacklistedFriends" :key="friend.id">
                                    <div class="top">
                                        <div class="left member--style2">
                                            <div class="member__thumb">
                                                <img :src="friend.profilePicture" alt="member-img">
                                                <span class="member__activity"></span>
                                            </div>
                                        </div>
                                        <div class="right">
                                            <a href="member-single.html"><h6>{{ friend.name }}</h6></a>
                                            <button class="btn btn-success" @@click="unblockUser(friend.id)">解鎖</button>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        new Vue({
            el: '#app',
            data: {
                activeTab: 'Newest',
                userId: 5, // 替換為您的用戶ID或從適當的地方獲取
                friends: [],
                blacklistedFriends: []
            },
            mounted() {
                this.fetchFriends();
            },
            methods: {
                switchTab(tab) {
                    this.activeTab = tab;
                },
                fetchFriends() {
                    axios.get(`/api/FriendApi/GetFriend/${this.userId}`)
                        .then(response => {
                            const data = response.data;
                            this.friends = data.filter(friend => friend.state !== 3);
                            this.blacklistedFriends = data.filter(friend => friend.state === 3);
                        })
                        .catch(error => {
                            console.error('Error:', error);
                        });
                },
                blockUser(friendId) {
                    axios.post('/api/FriendApi/BlockUser', { friendId }) // 传递为对象形式
                        .then(() => {
                            this.fetchFriends(); // 重新加载数据
                        })
                        .catch(error => {
                            console.error('Error:', error);
                        });
                },
                unblockUser(friendId) {
                    axios.post('/api/FriendApi/UnblockUser', { friendId }) // 传递为对象形式
                        .then(() => {
                            this.fetchFriends(); // 重新加载数据
                        })
                        .catch(error => {
                            console.error('Error:', error);
                        });
                }

            }
        });
    </script>
</body>
</html>
