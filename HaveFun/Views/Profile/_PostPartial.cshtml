<div class="tab-pane fade" id="gt6" role="tabpanel" aria-labelledby="gt6-tab">
    <div id="postPlatform">
        <!-- 發文form -->
        <div id="posts" class="col-xl-6 order-xl-1">
            <div class="group__bottom--left">
                <div class="tab-content" id="myTabContent">
                    <div class="tab-pane fade show active" id="gt1" role="tabpanel" aria-labelledby="gt1-tab">
                        <div class="group__bottom--area group__bottom--memberactivity">
                            <div class="group__bottom--body">
                                <div class="group__bottom--allmedia">
                                    <div class="media-wrapper">
                                        <div class="tab-content" id="myTabContent2">
                                            <div class="tab-pane fade show active" id="Personal" role="tabpanel"
                                                 aria-labelledby="Personal-tab">
                                                <div class="create-post mb-4">
                                                    <div class="lab-inner">
                                                        <div class="lab-thumb">
                                                            <div class="thumb-inner">
                                                                <div class="thumb-img">
                                                                    <img src="assets/images/member/profile/profile.jpg"
                                                                         alt="datting thumb">
                                                                </div>
                                                                <div class="thumb-content">
                                                                    <h6><a href="#">userName</a></h6>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="lab-content">
                                                            <form action="#" class="post-form">
                                                                <!-- 發文內容 -->
                                                                <input type="text" id="postContent"
                                                                       placeholder="說點什麼......">
                                                                <div class="content-type">
                                                                    <ul class="content-list">

                                                                        <li class="image-video">
                                                                            <div class="file-btn">
                                                                                <i class="fa-regular fa-image"></i>Photo
                                                                            </div>
                                                                            <input type="file">
                                                                        </li>

                                                                        <li class="post-submit">
                                                                            <input type="submit" value="發佈"
                                                                                   class="default-btn">
                                                                        </li>
                                                                    </ul>
                                                                </div>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                                <!-- 彈出視窗們 -->
                                                <!-- 刪除貼文視窗 -->
                                                <div class="deleteBox">
                                                    <span>確定要刪除貼文嗎？</span><br><br>
                                                    <button class="btn btn-danger">確定</button>
                                                    <button class="btn btn-outline-secondary" @@click="displayDeleteBox">取消</button>
                                                </div>
                                                <!-- 檢舉貼文視窗 -->
                                                <div class="ratBox">
                                                    <span>檢舉事由：</span><br>
                                                    <select class="form-select" id="inputState" v-model="ratReason">
                                                        <option selected value="">CHOOSE....</option>
                                                        <option v-for="item in ratItems">{{item.complaintCategoryName}}</option>
                                                    </select>
                                                    <input type="text" class="form-control" v-model="ratContent" />
                                                    <button class="btn btn-danger">確定</button>
                                                    <button class="btn btn-outline-secondary" @@click="displayRatBox">取消</button>
                                                </div>

                                                <!-- 貼文+留言 -->
                                                <!-- 大頭貼 + 名字 -->
                                                <div v-for="post in posts" class="post-item mb-4">
                                                    <div class="post-content">
                                                        <div class="post-author">
                                                            <div class="post-author-inner">
                                                                <div class="author-thumb">
                                                                    <img src="assets/images/member/profile/profile.jpg"
                                                                         alt="datting thumb">
                                                                </div>
                                                                <div class="author-details">
                                                                    <h6><a href="#">{{post.userName}}</a></h6>
                                                                    <div class="userAction">
                                                                        18
                                                                        <a href="#" id="btnLike">
                                                                            <i id="heart" @@click="clickLike" class="fa-regular fa-heart"></i>
                                                                        </a>
                                                                        <div class="btn-group">
                                                                            <button type="button" id="btnMore" class="btn btn-sm btn-link dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown" aria-expanded="false" @@click="showDropDown">
                                                                                <i class="fa-solid fa-ellipsis"></i>
                                                                            </button>
                                                                            <ul class="dropdown-menu">
                                                                                <li @@click="showDelete">
                                                                                    <a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#staticBackdrop">刪除貼文</a>

                                                                                </li>
                                                                                <li @@click="showRat(post)"><a class="dropdown-item" href="#">檢舉貼文</a></li>
                                                                            </ul>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <!-- 貼文內容 -->
                                                        <div class="post-description">
                                                            <p>{{post.contents}}</p>
                                                        </div>
                                                        <!-- 貼文時間 回覆數 分享鍵 -->
                                                        <div class="post-footer">
                                                            <p class="time">{{post.time}}</p>
                                                            <p>{{post.comment.length}} Comments</p>
                                                            <a href="#"><i class="fa-solid fa-share"></i> Share</a>
                                                        </div>
                                                    </div>

                                                    <div class="post-meta">
                                                        <div class="commentInput post-meta-top">
                                                            <input id="commentText" class="form-control" type="text" placeholder="請輸入回覆...">
                                                            <button id="commentSubmit" class="default-btn">送出</button>
                                                        </div>
                                                        <div class="expandComments" v-if="post.comment.length > 0">
                                                            <details @@toggle="post.expandState = !post.expandState">
                                                                <summary>{{post.expandState? '隱藏所有回覆' : '展開所有回覆'}}</summary>
                                                                <ul class="post-meta-bottom">
                                                                    <li v-for="com in post.comment">
                                                                        <div class="top">
                                                                            <div class="left member--style2">
                                                                                <div class="member__thumb">
                                                                                    <img src="assets/images/member/home2/01.jpg" alt="member-img">
                                                                                </div>
                                                                            </div>
                                                                            <div class="right">
                                                                                <p>{{com.userName}}</p>
                                                                                <p>{{com.contents}}</p>
                                                                                <p class="time">{{com.time}}</p>
                                                                            </div>
                                                                        </div>
                                                                    </li>
                                                                </ul>
                                                            </details>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="text-center mt-5">
                                                    <a href="#" class="default-btn">
                                                        <i class="fa-solid fa-spinner"></i> Load
                                                        More
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    window.ga = function () {
        ga.q.push(arguments)
    };
    ga.q = [];
    ga.l = +new Date;
    ga('create', 'UA-XXXXX-Y', 'auto');
    ga('set', 'anonymizeIp', true);
    ga('set', 'transport', 'beacon');
    ga('send', 'pageview')
</script>
<script src="https://www.google-analytics.com/analytics.js" async></script>
<script>
    const postPlatform = Vue.createApp({
        data() {
            return {
                baseAddress: "https://localhost:7152",
                posts: [],
                ratItems: [],
                watingToRatPost: [],
                RatCotent: '',
                RatReason: '',
            }
        },
        methods: {
            //
            getPostsList() {
                fetch(`${this.baseAddress}/api/Post/GetPostsRel`)
                    .then(res => res.json())
                    .then(data => { this.posts = data.map(post => ({ ...post, expandState: false })); })
                    .catch(error => { console.log('fetch posts failed!') });
            },
            getRatItemsList() {
                fetch(`${this.baseAddress}/api/Post/GetComplaintCategory`)
                    .then(res => res.json())
                    .then(data => { this.ratItems = data })
                    .catch(error => { console.log('fetch ratItems failed!') });
            },
            //按LIke變實心 尚未送回資料庫
            clickLike() {
                event.target.classList.toggle('fa-solid');
            },
            //按貼文點點按鈕出現刪除貼文&檢舉貼文選項
            showDropDown() {
                let target = null;
                if (event.target.tagName.toLowerCase() != "button") {
                    target = event.target.parentElement;
                } else {
                    target = event.target;
                }
                target.classList.toggle('show');
            },
            //顯示刪除貼文視窗
            showDelete() {
                event.preventDefault();
                $('.deleteBox').css("display", "block");
            },
            //取消刪除貼文視窗
            displayDeleteBox() {
                event.preventDefault();
                $('.deleteBox').css("display", "none");
            },
            //顯示檢舉貼文視窗
            showRat(post) {
                console.log(post);
                event.preventDefault();
                $('.ratBox').css("display", "block");
            },
            //取消檢舉貼文視窗
            displayRatBox() {
                event.preventDefault();
                $('.ratBox').css("display", "none");
                watingToRatPost = [];
                RatCotent = '';
                RatReason = '';
            },

        },
        mounted() {
            this.getPostsList();
            this.getRatItemsList();
        },
    })
        .mount("#postPlatform");
</script>
